<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NEO MAX – Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0f172a;
      --card: #1e293b;
      --card-hover: #334155;
      --text: #f1f5f9;
      --muted: #94a3b8;
      --green: #22c55e;
      --yellow: #eab308;
      --red: #ef4444;
      --accent: #3b82f6;
      --radius: 16px;
      --shadow: 0 4px 6px -1px rgba(0,0,0,.2), 0 2px 4px -2px rgba(0,0,0,.15);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', system-ui, sans-serif; background: var(--bg); color: var(--text); line-height: 1.5; min-height: 100vh; padding: 0 1.5rem 2rem; }
    .header {
      background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
      margin: 0 -1.5rem 1.5rem; padding: 1.75rem 1.5rem; border-radius: 0 0 var(--radius) var(--radius);
      box-shadow: var(--shadow);
    }
    .header h1 { font-size: 1.5rem; font-weight: 700; letter-spacing: -0.02em; }
    .header p { font-size: 0.875rem; color: var(--muted); margin-top: 0.25rem; }
    #data-source { font-size: 0.8125rem; color: var(--muted); margin-bottom: 1rem; }
    .summary-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;
    }
    .stat-card {
      background: var(--card); border-radius: var(--radius); padding: 1.25rem; box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,.06);
    }
    .stat-card .value { font-size: 1.5rem; font-weight: 700; color: var(--text); }
    .stat-card .label { font-size: 0.8125rem; color: var(--muted); margin-top: 0.25rem; }
    .stat-card.revenue .value { color: var(--green); }
    section { margin-bottom: 1.5rem; }
    section h2 { font-size: 1.125rem; font-weight: 600; margin-bottom: 0.75rem; color: var(--text); }
    .card { background: var(--card); border-radius: var(--radius); padding: 1rem 1.25rem; margin-bottom: 0.75rem; box-shadow: var(--shadow); border: 1px solid rgba(255,255,255,.06); }
    table { width: 100%; border-collapse: collapse; font-size: 0.875rem; }
    th, td { text-align: left; padding: 0.65rem 0.75rem; border-bottom: 1px solid rgba(255,255,255,.06); }
    th { color: var(--muted); font-weight: 600; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; }
    tr:hover { background: rgba(255,255,255,.03); }
    .badge { display: inline-block; padding: 0.2rem 0.5rem; border-radius: 6px; font-size: 0.75rem; font-weight: 600; }
    .badge.active { background: rgba(34,197,94,.2); color: var(--green); }
    .badge.improve { background: rgba(234,179,8,.2); color: var(--yellow); }
    .badge.discarded { background: rgba(239,68,68,.2); color: var(--red); }
    .muted { color: var(--muted); font-size: 0.8125rem; }
    .load-err { color: var(--red); padding: 1rem; background: rgba(239,68,68,.1); border-radius: 8px; }
    .portals-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 0.75rem; }
    .portal-link {
      display: block; background: var(--card); border-radius: var(--radius); padding: 1rem 1.25rem;
      color: var(--accent); text-decoration: none; font-weight: 600; box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,.06); transition: background 0.15s;
    }
    .portal-link:hover { background: var(--card-hover); color: #60a5fa; }
    .portal-link .label { font-size: 0.9375rem; }
    .portal-link .url { font-size: 0.75rem; color: var(--muted); margin-top: 0.25rem; word-break: break-all; }
  </style>
</head>
<body>
  <header class="header">
    <h1>NEO MAX Dashboard</h1>
    <p>Seguimiento en vivo · Micro-SaaS creados por el loop · Se actualiza solo</p>
  </header>
  <p id="data-source" class="muted">Cargando dashboard_data.json…</p>
  <section id="portals-section" style="display:none;">
    <h2>Sitios creados – Ver contenido en vivo</h2>
    <p class="muted" style="margin-bottom:0.75rem;">Enlaces a los portales que NEO va publicando. Ábrelos desde el móvil para ver el contenido.</p>
    <div id="portals-list" class="portals-grid"></div>
  </section>
  <section id="summary-section" style="display:none;">
    <div class="summary-grid">
      <div class="stat-card"><span class="value" id="total-tools">0</span><div class="label">Herramientas</div></div>
      <div class="stat-card"><span class="value" id="active-tools">0</span><div class="label">Activas</div></div>
      <div class="stat-card"><span class="value" id="total-visits">0</span><div class="label">Visitas</div></div>
      <div class="stat-card"><span class="value" id="total-clicks">0</span><div class="label">Clicks</div></div>
      <div class="stat-card revenue"><span class="value">$<span id="est-revenue">0</span></span><div class="label">Est. revenue</div></div>
    </div>
    <p id="rpm-note" class="muted" style="font-size:0.75rem;"></p>
  </section>
  <section id="tools-section">
    <h2>Herramientas</h2>
    <div class="card"><div id="tools-list"></div></div>
  </section>
  <section id="decisions-section">
    <h2>Últimas decisiones</h2>
    <div class="card"><div id="decisions-list"></div></div>
  </section>
  <footer class="muted" style="margin-top:2rem;padding-top:1rem;border-top:1px solid rgba(255,255,255,.06);font-size:0.8125rem;">
    Si configuraste <code>dashboard_repo_name</code> en config, el dashboard se publica en GitHub Pages y puedes abrirlo desde cualquier sitio (móvil, fuera de casa) en la URL que indica el log al exportar (ej. <code>https://tu-usuario.github.io/neo-max-dashboard/</code>).
  </footer>
  <script>
    (function() {
      var dataPath = 'dashboard_data.json';
      var xhr = new XMLHttpRequest();
      xhr.open('GET', dataPath);
      xhr.onload = function() {
        if (xhr.status !== 200) {
          document.getElementById('data-source').textContent = 'No se pudo cargar ' + dataPath + '. Ejecuta "python -m loop_saas review" para generar datos.';
          document.getElementById('tools-list').innerHTML = '<p class="load-err">Coloca dashboard_data.json en la misma carpeta que este HTML, o ejecuta desde NEO MAX: python -m loop_saas review</p>';
          return;
        }
        var data = JSON.parse(xhr.responseText);
        document.getElementById('data-source').textContent = 'Actualizado: ' + (data.generated_at || '') + ' · ' + (data.tools && data.tools.length) + ' herramientas · ' + (data.decisions && data.decisions.length) + ' decisiones';
        var portals = data.portals || [];
        if (portals.length) {
          document.getElementById('portals-section').style.display = 'block';
          var pHtml = '';
          portals.forEach(function(p) {
            var url = p.base_url || ('https://' + (p.name || '') + '.github.io');
            pHtml += '<a href="' + url + '" target="_blank" rel="noopener" class="portal-link"><span class="label">' + (p.label || p.name || 'Portal') + '</span><span class="url">' + url + '</span></a>';
          });
          document.getElementById('portals-list').innerHTML = pHtml;
        }
        var s = data.summary || {};
        if (s.total_tools != null) {
          document.getElementById('summary-section').style.display = 'block';
          document.getElementById('total-tools').textContent = s.total_tools || 0;
          document.getElementById('active-tools').textContent = s.active_tools != null ? s.active_tools : 0;
          document.getElementById('total-visits').textContent = s.total_visits != null ? s.total_visits : 0;
          document.getElementById('total-clicks').textContent = s.total_clicks != null ? s.total_clicks : 0;
          document.getElementById('est-revenue').textContent = s.estimated_revenue_usd != null ? s.estimated_revenue_usd : 0;
          document.getElementById('rpm-note').textContent = s.rpm_note || '';
        }
        var tools = data.tools || [];
        var html = '<table><thead><tr><th>Herramienta</th><th>Estado</th><th>Calidad</th><th>Score</th><th>Visitas</th><th>Clicks</th><th>Creado</th></tr></thead><tbody>';
        tools.forEach(function(t) {
          var status = (t.status || 'active');
          var badgeClass = 'badge ' + status;
          html += '<tr><td><strong>' + (t.title || t.slug || '') + '</strong><br><span class="muted">' + (t.slug || '') + '</span></td><td><span class="' + badgeClass + '">' + status + '</span></td><td>' + (t.quality_score != null ? t.quality_score : '–') + '</td><td>' + (t.score_final != null ? t.score_final : '–') + '</td><td>' + (t.visits || 0) + '</td><td>' + (t.clicks || 0) + '</td><td class="muted">' + (t.created_at || '') + '</td></tr>';
        });
        html += '</tbody></table>';
        document.getElementById('tools-list').innerHTML = tools.length ? html : '<p class="muted">Aún no hay herramientas. El loop las irá añadiendo.</p>';
        var decisions = data.decisions || [];
        var dHtml = '<table><thead><tr><th>Tool</th><th>Acción</th><th>Score</th><th>Razón</th><th>Fecha</th></tr></thead><tbody>';
        decisions.slice(0, 30).forEach(function(d) {
          dHtml += '<tr><td>' + (d.tool_slug || '') + '</td><td>' + (d.action || '') + '</td><td>' + (d.score_final != null ? d.score_final : '') + '</td><td>' + (d.reason || '') + '</td><td class="muted">' + (d.created_at || '') + '</td></tr>';
        });
        dHtml += '</tbody></table>';
        document.getElementById('decisions-list').innerHTML = decisions.length ? dHtml : '<p class="muted">Sin decisiones aún.</p>';
      };
      xhr.onerror = function() {
        document.getElementById('data-source').textContent = 'Error al cargar. Abre este archivo desde la carpeta output/dashboard (donde está dashboard_data.json).';
        document.getElementById('tools-list').innerHTML = '<p class="load-err">Ejecuta en NEO MAX: python -m loop_saas review</p>';
      };
      xhr.send();
    })();
  </script>
</body>
</html>
